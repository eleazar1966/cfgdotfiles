// Este archivo de configuración está en formato KDL: https://kdl.dev
// Versión adaptada de la configuración de Hyprland.
// Siéntete libre de ajustarla.
prefer-no-csd
// Configuración del dispositivo de entrada.
// Encuentra la lista completa de opciones en la wiki:
// https://yalter.github.io/niri/Configuration:-Input
input {
    keyboard {
        xkb {
            // Puedes establecer reglas, modelo, layout, variante y opciones.
            // Para más información, consulta xkeyboard-config(7).
            // Mapeo de la configuración kb_layout y kb_options de Hyprland
            layout "us,es"
            options "grp:alt_shift_toggle"

            // Si esta sección está vacía, niri obtendrá la configuración xkb
            // de org.freedesktop.locale1. Puedes controlarlas usando
            // localectl set-x11-keymap.
        }

        // Habilita Num Lock al inicio, omitir esta configuración lo deshabilita.
        // Mapeo de numlock_by_default = true de Hyprland
        numlock
    }

    // Las siguientes secciones incluyen configuraciones de libinput.
    // Omitir las configuraciones las deshabilita o las deja en sus valores predeterminados.
    // Todos los ajustes comentados aquí son ejemplos, no valores predeterminados.

    // El touchpad tiene natural-scroll = false en Hyprland, por lo que se deshabilita aquí.
    touchpad {
        // off
        tap // Habilitar la función de tocar para hacer clic
        // dwt
        // dwtp
        // drag false
        // drag-lock
        // natural-scroll // Deshabilitado para coincidir con el valor 'false' de Hyprland
        // accel-speed 0.2
        // accel-profile "flat"

        // scroll-method "two-finger"
        // disabled-on-external-mouse
    }

    // mouse {
    //     // off
    //     // natural-scroll
    //     // accel-speed 0.2
    //     // accel-profile "flat"
    //     // scroll-method "no-scroll"
    // }

    // Descomenta esto para hacer que el ratón se mueva al centro de las ventanas recién enfocadas.
    warp-mouse-to-focus

    // Enfoca ventanas y salidas automáticamente al mover el ratón hacia ellas.
    // Establecer max-scroll-amount="0%" hace que funcione solo en ventanas que ya están completamente en pantalla.
    // focus-follows-mouse se establece en 1 en Hyprland, lo cual no tiene un equivalente
    // directo. Aquí se deja desactivado por defecto de Niri, pero se puede habilitar si se desea.
    focus-follows-mouse max-scroll-amount="0%"

    // trackpoint {
    //     // off
    //     // natural-scroll
    //     // accel-speed 0.2
    //     // accel-profile "flat"
    //     // scroll-method "on-button-down"
    //     // scroll-button 273
    //     // scroll-button-lock
    //     // middle-emulation
    // }
}

// Configuración del monitor.
// Puedes configurar las salidas por su nombre, que puedes encontrar
// ejecutando `niri msg outputs` dentro de una instancia de niri.
// Encuentra más información en la wiki:
// https://yalter.github.io/niri/Configuration:-Outputs
// Recuerda descomentar el nodo quitando "/-"!
// La configuración de Hyprland es: monitor= DP-1, 1366x768@59.79, 0x0, 1
// Asegúrate de que el nombre de la salida (DP-1) sea correcto para Niri.
// La escala es 1 (100%).
/-output "DP-1" {
    // Descomenta esta línea para deshabilitar esta salida.
    // off

    // Resolución y, opcionalmente, frecuencia de actualización de la salida.
    // El formato es "<ancho>x<alto>" o "<ancho>x<alto>@<frecuencia de actualización>".
    mode "1366x768@59.79"

    // Puedes usar escala entera o fraccionaria.
    scale 1

    // Transform permite rotar la salida en sentido antihorario.
    transform "normal"

    // Posición de la salida en el espacio de coordenadas global.
    // position x=0 y=0
}

// Configuraciones que influyen en cómo se posicionan y dimensionan las ventanas.
// Encuentra más información en la wiki:
// https://yalter.github.io/niri/Configuration:-Layout
layout {
    // Establece los espacios alrededor de las ventanas en píxeles lógicos.
    // Mapeo de gaps_in y gaps_out de Hyprland
    // Gaps in = 2, Gaps out = 2 (se establece un único valor para ambos en Niri: 2)
    gaps 2

    // Cuándo centrar una columna al cambiar el foco.
    center-focused-column "on-overflow" // "never" es el valor predeterminado de Niri, "on-overflow" se usa para mejor experiencia.

    // Se pueden personalizar los anchos preestablecidos con `preset-column-widths` (Mod+R)
    // preset-column-widths { ... }

    // Se pueden personalizar las alturas preestablecidas con `preset-window-heights` (Mod+Shift+R)
    // preset-window-heights { }

    // Se puede cambiar el ancho predeterminado de las nuevas ventanas.
    // default-column-width { proportion 0.5; }

    // Puedes cambiar cómo se ve el anillo de foco.
    // El anillo de foco y el borde se configuran aquí.
    focus-ring {
        // off // Descomentar para deshabilitar el anillo de foco.

        // Cuántos píxeles lógicos se extiende el anillo desde las ventanas.
        width 1.5 // Mapeo de border_size = 2 de Hyprland

        // Color del anillo en el monitor activo.
        // Se utilizan los colores predeterminados de Niri ya que los de Hyprland usan variables KDL.
        active-color "#7fc8ff"

        // Color del anillo en monitores inactivos.
        inactive-color "#505050"

        // También puedes usar gradientes, tienen prioridad sobre los colores sólidos.
        // active-gradient from="#80c8ff" to="#c7ff7f" angle=45
    }

    // También puedes añadir un borde. Es similar al anillo de foco, pero siempre visible.
    // Si habilitas el borde, probablemente querrás deshabilitar el anillo de foco.
    border {
        // Se deshabilita el borde para depender únicamente del anillo de foco, como en Hyprland
        // con un border_size pequeño.
        off

        width 1.5 // Mapeo de border_size = 2 de Hyprland (aunque está deshabilitado)
        active-color "#ffc87f"
        inactive-color "#505050"

        // Color del borde alrededor de las ventanas que solicitan tu atención.
        urgent-color "#9b0000"
    }

    // Puedes habilitar sombras para las ventanas.
    shadow {
        on // enabled = true (Mapeo de la sombra de Hyprland)

        // Puedes cambiar cómo se ven las sombras.
        // Softness controla el radio de desenfoque de la sombra.
        softness 30 // Mapeo de Hyprland (ajustamos a un valor de Niri)

        // Spread expande la sombra.
        spread 5 // Mapeo de Hyprland (ajustamos a un valor de Niri)

        // Offset mueve la sombra con respecto a la ventana.
        offset x=0 y=5

        // También puedes cambiar el color y la opacidad de la sombra.
        color "#1a1a1aee" // Mapeo de color = rgba(1a1a1aee)

        // draw-behind-window true // Descomentar para que la sombra se dibuje detrás de su ventana.
    }

    // Struts reducen el área ocupada por las ventanas.
    // Struts no se establecen en la configuración de Hyprland, por lo que se dejan comentados.
    struts {
        // left 64
        // right 64
        // top 64
        // bottom 64
    }

    // prefer-no-csd // Descomentar para pedir a los clientes que omitan sus decoraciones del lado del cliente si es posible.
}

// El desenfoque es una característica de Hyprland (decorations.blur),
// Niri lo implementa de manera diferente y no tiene un mapeo directo aquí.

// Agrega líneas como esta para iniciar procesos al inicio.
// Mapeo de las variables de autostart (exec-once) de Hyprland
spawn-at-startup "swww-daemon"
spawn-at-startup "~/.local/share/systools/mostrar_imagenes.sh"
spawn-at-startup "pipewire"
spawn-at-startup "udiskie" "-s"
spawn-at-startup "openrgb" "--startminimized"
spawn-at-startup "nm-applet" "--indicator"

// Para ejecutar un comando shell (con variables, tuberías, etc.), usa spawn-sh-at-startup:
// Hyprland tiene waybar & pkill waybar & ~/.local/share/systools/launch-waybar.sh
// Se ajusta el orden para iniciar waybar
spawn-sh-at-startup "pkill waybar || ~/.local/share/systools/launch-waybar.sh & waybar"

hotkey-overlay {
    // skip-at-startup // Descomentar para deshabilitar la ventana emergente de "Atajos Importantes" al inicio.
}

// Puedes cambiar la ruta donde se guardan las capturas de pantalla.
// screenshot-path "~/Pictures/Screenshots/Screenshot from %Y-%m-%d %H-%M-%S.png"

// Configuraciones de animación.
// La wiki explica cómo configurar animaciones individuales:
// Se utilizan curvas y velocidades predeterminadas de Niri.
animations {
    // off // Descomentar para desactivar todas las animaciones.
    // enabled = yes, please :) se mapea a la activación.
    // Los valores de velocidad y curva se dejan por defecto en Niri.

    // slowdown 3.0 // Ralentiza todas las animaciones por este factor.
}

// Las reglas de ventana te permiten ajustar el comportamiento para ventanas individuales.
// Regla para WezTerm (Workaround del bug de configuración inicial)
window-rule {
    match app-id=r#"^org\.wezfurlong\.wezterm$"#
    default-column-width {}
}

// Regla para Firefox Picture-in-Picture (Abrir flotante)
window-rule {
    match app-id=r#"firefox$"# title="^Picture-in-Picture$"
    open-floating true
}

// Regla de ventana (windowrule)
// La regla de ignorar maximización es la más relevante para el tiling.
window-rule {
    // La supresión de eventos de maximización no tiene un equivalente directo,
    // se podría usar fullscreen-window, pero se prefiere el comportamiento de tiling.
    // open-floating true
    // draw-border-with-background true

    geometry-corner-radius 8 // Ajusta este valor (e.g., 8, 10, 15)
    clip-to-geometry true
}


// Atajos de teclado.
// Hyprland usa $mainMod = SUPER. Niri usa Mod, que es Super por defecto.
binds {
    // Mod-Shift-/, que suele ser lo mismo que Mod-?,
    // muestra una lista de atajos importantes.
    Mod+Shift+Slash { show-hotkey-overlay; }

    // Vinculaciones de programas
    Mod+Return hotkey-overlay-title="Abrir Terminal: kitty" { spawn "kitty"; } // $terminal = kitty
    Mod+E hotkey-overlay-title="Abrir Gestor de Archivos: thunar" { spawn "thunar"; } // $fileManager = thunar
    // Mapeo de $menu: pkill rofi || ~/.config/rofi/launchers/type-2/launcher.sh
    Mod+D hotkey-overlay-title="Ejecutar Aplicación: rofi" { spawn-sh "pkill rofi || ~/.config/rofi/launchers/type-2/launcher.sh"; }

    // Otras vinculaciones
    Mod+Q repeat=false { close-window; } // killactive
    Mod+X { quit; } // exit
    Mod+V { toggle-window-floating; } // togglefloating

    // El comando de Hyprland `pseudo` (pseudotiling) se omite, ya que Niri tiene un comportamiento diferente.
    // El comando de Hyprland `togglesplit` (dwindle) se omite, ya que Niri usa un diseño de columna/pila.

    // Comandos de Hyprland ejecutados con spawn
    Mod+W { spawn "~/.local/share/systools/launch-waybar.sh"; }
    Mod+F1 { spawn "opera" "--lang=es" "%U" "--private"; }
    Mod+F2 { spawn "thunderbird"; }
    Mod+F3 { spawn "kitty" "-e" "ranger"; }
    Mod+F4 { spawn "rhythmbox"; }
    Mod+F11 { spawn "vlc"; }

    // Capturas de pantalla (Hyprland usa hyprshot)
    Mod+Print { spawn "hyprshot" "-m" "window"; } // Screenshot a window
    Print { spawn "hyprshot" "-m" "output"; } // Screenshot a monitor
    Mod+Shift+Print { spawn "hyprshot" "-m" "region"; } // Screenshot a region
    // Capturas de pantalla nativas de Niri (alternativas)
    // Print { screenshot; }
    // Ctrl+Print { screenshot-screen; }
    // Alt+Print { screenshot-window; }

    // Mover foco (movefocus l/r/u/d)
    Mod+Left  { focus-column-left; }
    Mod+Down  { focus-window-down; }
    Mod+Up    { focus-window-up; }
    Mod+Right { focus-column-right; }
    Mod+H     { focus-column-left; }
    Mod+J     { focus-window-down; }
    Mod+K     { focus-window-up; }
    Mod+L     { focus-column-right; }

    // Mover columna/ventana
    Mod+Ctrl+Left  { move-column-left; }
    Mod+Ctrl+Down  { move-window-down; }
    Mod+Ctrl+Up    { move-window-up; }
    Mod+Ctrl+Right { move-column-right; }
    Mod+Ctrl+H     { move-column-left; }
    Mod+Ctrl+J     { move-window-down; }
    Mod+Ctrl+K     { move-window-up; }
    Mod+Ctrl+L     { move-column-right; }

    // Enfoque y movimiento de monitor
    // Mod+Shift+Left  { focus-monitor-left; }
    // Mod+Shift+Ctrl+Left  { move-column-to-monitor-left; }
    // Alternativamente, comandos para mover solo una ventana:
    // Mod+Shift+Ctrl+Left  { move-window-to-monitor-left; }
    // Y mover todo un espacio de trabajo:
    // Mod+Shift+Ctrl+Left  { move-workspace-to-monitor-left; }

    // Enfoque de espacio de trabajo (Focus Workspace)
    Mod+Page_Down	  { focus-workspace-down; }
    Mod+Page_Up        { focus-workspace-up; }
    Mod+U              { focus-workspace-down; }
    Mod+I              { focus-workspace-up; }

    // Mover columna a espacio de trabajo (Move Column to Workspace)
    Mod+Ctrl+Page_Down { move-column-to-workspace-down; }
    Mod+Ctrl+Page_Up   { move-column-to-workspace-up; }
    Mod+Ctrl+U         { move-column-to-workspace-down; }
    Mod+Ctrl+I         { move-column-to-workspace-up; }
    // Alternativamente, comandos para mover solo una ventana:
    // Mod+Ctrl+Page_Down { move-window-to-workspace-down; }

    // Mover espacio de trabajo (Move Workspace)
    Mod+Shift+Page_Down { move-workspace-down; }
    Mod+Shift+Page_Up   { move-workspace-up; }
    Mod+Shift+U         { move-workspace-down; }
    Mod+Shift+I         { move-workspace-up; }

    // Rueda del ratón para espacio de trabajo
    // Se usa cooldown-ms=150 para evitar desplazarse demasiado rápido.
    Mod+WheelScrollDown	cooldown-ms=150 { focus-workspace-down; }
    Mod+WheelScrollUp        cooldown-ms=150 { focus-workspace-up; }
    Mod+Ctrl+WheelScrollDown cooldown-ms=150 { move-column-to-workspace-down; }
    Mod+Ctrl+WheelScrollUp   cooldown-ms=150 { move-column-to-workspace-up; }

    // Rueda del ratón para columna
    Mod+WheelScrollRight	 { focus-column-right; }
    Mod+WheelScrollLeft	 { focus-column-left; }
    Mod+Ctrl+WheelScrollRight { move-column-right; }
    Mod+Ctrl+WheelScrollLeft  { move-column-left; }

    // Desplazamiento horizontal con Shift (simulado con columna)
    Mod+Shift+WheelScrollDown      { focus-column-right; }
    Mod+Shift+WheelScrollUp        { focus-column-left; }
    Mod+Ctrl+Shift+WheelScrollDown { move-column-right; }
    Mod+Ctrl+Shift+WheelScrollUp   { move-column-left; }

    // Cambiar de espacio de trabajo (workspace 1-10)
    Mod+1 { focus-workspace 1; }
    Mod+2 { focus-workspace 2; }
    Mod+3 { focus-workspace 3; }
    Mod+4 { focus-workspace 4; }
    Mod+5 { focus-workspace 5; }
    Mod+6 { focus-workspace 6; }
    Mod+7 { focus-workspace 7; }
    Mod+8 { focus-workspace 8; }
    Mod+9 { focus-workspace 9; }
    Mod+0 { focus-workspace 10; }

    // Mover columna a espacio de trabajo (movetoworkspace 1-10)
    // Niri usa Mod+Ctrl+ [número] como el equivalente más cercano a Mod+Shift+ [número] de Hyprland para mover.
    Mod+Ctrl+1 { move-column-to-workspace 1; }
    Mod+Ctrl+2 { move-column-to-workspace 2; }
    Mod+Ctrl+3 { move-column-to-workspace 3; }
    Mod+Ctrl+4 { move-column-to-workspace 4; }
    Mod+Ctrl+5 { move-column-to-workspace 5; }
    Mod+Ctrl+6 { move-column-to-workspace 6; }
    Mod+Ctrl+7 { move-column-to-workspace 7; }
    Mod+Ctrl+8 { move-column-to-workspace 8; }
    Mod+Ctrl+9 { move-column-to-workspace 9; }
    Mod+Ctrl+0 { move-column-to-workspace 10; }

    // Espacio de trabajo especial (scratchpad)
    Mod+S { toggle-overview; } // Equivalente más cercano: Vista general
    // La acción de Hyprland `movetoworkspace, special:magic` no tiene un equivalente directo.

    // Ajustes de ancho/altura de columna/ventana
    Mod+R { switch-preset-column-width; }
    Mod+Shift+R { switch-preset-window-height; }
    Mod+Ctrl+R { reset-window-height; }
    Mod+F { maximize-column; }
    Mod+Shift+F { fullscreen-window; }
    Mod+Minus { set-column-width "-10%"; }
    Mod+Equal { set-column-width "+10%"; }
    Mod+Shift+Minus { set-window-height "-10%"; }
    Mod+Shift+Equal { set-window-height "+10%"; }

    // Mover/cambiar tamaño de ventana con el ratón
    // Niri usa Mod+clic y arrastrar, que es el comportamiento predeterminado en Hyprland (bindm).
    // Las acciones `movewindow` y `resizewindow` son manejadas por el compositor por defecto.

    // Teclas multimedia (se usa la vinculación wpctl de Hyprland)
    XF86AudioRaiseVolume allow-when-locked=true { spawn-sh "wpctl set-volume -l 1 @DEFAULT_AUDIO_SINK@ 5%+"; }
    XF86AudioLowerVolume allow-when-locked=true { spawn-sh "wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-"; }
    XF86AudioMute        allow-when-locked=true { spawn-sh "wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle"; }
    XF86AudioMicMute     allow-when-locked=true { spawn-sh "wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle"; }

    // Brillo (se usa la vinculación brightnessctl de Hyprland)
    XF86MonBrightnessUp allow-when-locked=true { spawn "brightnessctl" "-e4" "-n2" "set" "5%+"; }
    XF86MonBrightnessDown allow-when-locked=true { spawn "brightnessctl" "-e4" "-n2" "set" "5%-"; }

    // Control de reproductor (playerctl)
    XF86AudioNext        allow-when-locked=true { spawn-sh "playerctl next"; }
    XF86AudioPlay        allow-when-locked=true { spawn-sh "playerctl play-pause"; } // Mapea Play y Pause
    XF86AudioPrev        allow-when-locked=true { spawn-sh "playerctl previous"; }
    XF86AudioStop        allow-when-locked=true { spawn-sh "playerctl stop"; }

    // Quitar sesión
    // La acción `quit` de Niri muestra un diálogo de confirmación por defecto.
    Mod+Shift+E { quit; }
    Ctrl+Alt+Delete { quit; }

    // Otras acciones útiles de Niri (sin mapeo directo en Hyprland config.kdl.ia)
    // Mod+W { toggle-column-tabbed-display; } // Alternar modo de visualización en pestañas
    // Mod+Shift+V { switch-focus-between-floating-and-tiling; }
    // Mod+C { center-column; }
    // Mod+Ctrl+C { center-visible-columns; }
    // Mod+Escape allow-inhibiting=false { toggle-keyboard-shortcuts-inhibit; } // Alternar el inhibidor de atajos (para apps KVM)
    // Mod+Shift+P { power-off-monitors; }
}
